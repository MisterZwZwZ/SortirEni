{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}
{% block title_2 %}Filtrer les sorties{% endblock title_2 %}
{% block taille %}w-75{% endblock taille %}
{% block taille2 %}w-75{% endblock taille2 %}

{% block body %}

    {{ form_start(form_accueil) }}
    <div class="row mx-2">

        <div class="col-7">
            {{ form_row(form_accueil.campus) }}
            {{ form_row(form_accueil.nomRecherche) }}
            <div class="row">
                <div class="col-6">
                    {{ form_row(form_accueil.dateHeureDebutRecherche) }}
                </div>
                <div class="col-6">
                    {{ form_row(form_accueil.dateFinRecherche) }}
                </div>
            </div>
        </div>


        <div class="col-5 align-self-end">
            {{ form_row(form_accueil.SortiesOrganisateurs) }}
            {{ form_row(form_accueil.SortiesInscrits) }}
            {{ form_row(form_accueil.SortiesNonInscrits) }}
            {{ form_row(form_accueil.SortiesPassees) }}
        </div>
    </div>
    {{ form_end(form_accueil) }}

    <div  id="content" class="mt-3">
        <table class="table border border-light">
            <thead>
            <tr class="table-dark">
                <th>Nom de la sortie</th>
                <th>Date de la sortie</th>
                <th>Clôture</th>
                <th>Inscrits/Places</th>
                <th>Etat</th>
                <th>Inscrit</th>
                <th>Organisateur</th>
                <th>Actions</th>
            </tr>


        </thead>
        <tbody>
        {% for sorties in listeSorties %}
                {% if  sorties.etatSortie.getId == 1 %}
                    <tr class="table-default">
                {% elseif  sorties.etatSortie.getId == 2 %}
                    <tr class="table-success">
                {% elseif  sorties.etatSortie.getId == 3 %}
                    <tr class="table-primary">
                {% elseif  sorties.etatSortie.getId == 4 %}
                    <tr class="table-info">
                {% elseif  sorties.etatSortie.getId == 5 %}
                    <tr class="table-warning">
                {% elseif  sorties.etatSortie.getId == 6 %}
                    <tr class="table-danger">
                {% endif %}
                <th scope="row">{{ sorties.nom }}</th>
                <td>{{ sorties.dateHeureDebut|date('d/m/y')}}</td>
                <td>{{ sorties.dateLimiteInscription|date('d/m/y') }}</td>
                <td  class="d-flex justify-content-center">{{ sorties.listeDesInscrits | length }}/{{ sorties.nbIncriptionsMax }}</td>
                <td>{{ sorties.etatSortie.libelle}}</td>
                <td>
                    {% set inscrit = 'false' %}
                    {% for userInscrit in sorties.listeDesInscrits %}
                        {% if userInscrit.id == app.user.id %}
                            {% set inscrit = 'true' %}
                            <i class="fas fa-times d-flex justify-content-center"></i>
                        {% endif %}
                    {% endfor %}
                </td>
                <td>  <a href="{{ path('profil_afficher', {'id': sorties.organisateur.id }) }}">{{ sorties.organisateur.pseudo}}</a></td>
                <td>
                    {% if date() <= sorties.dateLimiteInscription %}
                        {% if sorties.etatSortie.getId != 6 %}
                            {% with %}
                                    {% if sorties.listeDesInscrits|length < sorties.nbIncriptionsMax %}
                                        {% if inscrit == 'true' %}
                                            <a href={{ url('default_desinscription',{'id': sorties.id }) }}>Se désinscrire -</a>
                                        {% elseif inscrit == 'false' %}
                                            <a href={{ url('default_inscription',{'id': sorties.id }) }}>S'incrire -</a>
                                        {% endif %}
                                    {% endif %}
                                {% if sorties.listeDesInscrits|length == sorties.nbIncriptionsMax %}
                                    Complet -
                                    {% if inscrit == 'true' %}
                                        <a href={{ url('default_desinscription',{'id': sorties.id }) }}>Se désinscrire -</a>
                                    {% endif %}
                                {% endif %}
                                {% endwith %}
                            {% endif %}
                        {% endif %}
                        {% if app.user.id == sorties.organisateur.id %}
                            {% if sorties.etatSortie.getId == 1 %}
                                <a href="{{ path('sortie_edit', {'id':sorties.id}) }}">Modifier -</a>
                            {% endif %}
                            {% if sorties.etatSortie.getId == 2 or sorties.etatSortie.getId == 3 %}
                                <a href="{{ path('sortie_annuler', {'id': sorties.id }) }}">Annuler -</a>
                            {% endif %}
                        {% endif %}
                        <a href="{{ path('sortie_show',{'id': sorties.id}) }}">Afficher</a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div>
        <button class="btn btn-primary"><a class="customize" href="{{ path('sortie_new') }}">Créer sortie <i class="fas fa-plus"></i></a></button>
    </div>

{% endblock body%}
{% block script %}
    <script src="{{ asset('js/ajaxSearch.js') }}"></script>
    <script src="{{ asset('js/datesSearch.js') }}"></script>
{% endblock %}
